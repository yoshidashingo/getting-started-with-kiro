# Chat Context（チャットコンテキスト）完全ガイド

## 概要

Kiroの**Chat Context**機能は、AIに必要な情報を簡単かつ効率的に伝えるための強力な仕組みです。`#`記号を使って様々な種類のコンテキストを参照することで、より正確で的確な支援を受けることができます。

## 利用可能なコンテキスト機能

Kiroは6つの主要なコンテキスト参照機能を提供します：

### 1. #File - ファイル参照

特定のファイルの内容をKiroに伝えます。

#### 基本的な使い方

```
#File src/components/UserProfile.tsx

このコンポーネントを最適化してください。
```

#### 複数ファイルの参照

```
#File src/components/UserProfile.tsx
#File src/types/User.ts
#File src/hooks/useUser.ts

これらのファイルの関係性を説明してください。
```

#### 活用シーン

- **コードレビュー**: 特定のファイルのレビューを依頼
- **リファクタリング**: ファイルの改善提案を受ける
- **バグ修正**: 問題のあるファイルを特定して修正
- **ドキュメント生成**: コードからドキュメントを自動生成

#### 実践例

```
# 例1: パフォーマンス最適化
#File src/utils/dataProcessor.ts

このファイルのパフォーマンスを改善してください。
特に、大量データ処理の部分を最適化したいです。

# 例2: TypeScript型の改善
#File src/types/api.ts

型定義をより厳密にして、型安全性を向上させてください。

# 例3: テストの追加
#File src/services/authService.ts

このサービスの単体テストを作成してください。
エッジケースも含めて網羅的にテストしたいです。
```

### 2. #Folder - フォルダ参照

フォルダ全体の構造とファイル一覧をKiroに伝えます。

#### 基本的な使い方

```
#Folder src/components/

このフォルダの構造を説明してください。
```

#### 活用シーン

- **構造分析**: プロジェクト構造の理解
- **リファクタリング計画**: フォルダ構成の改善提案
- **新規機能追加**: 既存構造に合わせた実装
- **ドキュメント作成**: フォルダ構造のドキュメント化

#### 実践例

```
# 例1: 構造の改善提案
#Folder src/components/

このフォルダの構造を分析して、
より保守しやすい構成を提案してください。

# 例2: 新規コンポーネントの追加
#Folder src/components/user/

既存のパターンに従って、
UserSettingsコンポーネントを追加してください。

# 例3: 命名規則の統一
#Folder src/services/

ファイル命名規則を統一してください。
kebab-caseに統一したいです。
```

### 3. #Problems - 問題参照

現在のエディタで検出されているエラー、警告、リント問題をKiroに伝えます。

#### 基本的な使い方

```
#Problems

現在の問題を全て修正してください。
```

#### 検出される問題の種類

- **構文エラー**: TypeScript/JavaScriptの構文エラー
- **型エラー**: TypeScriptの型チェックエラー
- **リント警告**: ESLint、Prettierの警告
- **セキュリティ警告**: 潜在的なセキュリティ問題
- **パフォーマンス警告**: 非効率なコードパターン

#### 活用シーン

- **エラー修正**: 検出されたエラーの一括修正
- **コード品質向上**: リント警告の解消
- **型安全性向上**: 型エラーの修正
- **ベストプラクティス適用**: 推奨パターンへの変更

#### 実践例

```
# 例1: 型エラーの修正
#Problems

TypeScriptの型エラーを全て修正してください。
型推論を活用して、明示的な型注釈を最小限にしてください。

# 例2: ESLint警告の解消
#Problems

ESLintの警告を全て解消してください。
ただし、意図的な実装は維持してください。

# 例3: セキュリティ問題の修正
#Problems

セキュリティ関連の警告を優先的に修正してください。
XSSやSQLインジェクションのリスクを排除したいです。
```

### 4. #Terminal - ターミナル参照

ターミナルの出力内容（コマンド履歴、エラーメッセージなど）をKiroに伝えます。

#### 基本的な使い方

```
#Terminal

このエラーを解決してください。
```

#### 活用シーン

- **エラー解決**: コマンド実行時のエラー対応
- **ビルドエラー修正**: ビルド失敗の原因特定と修正
- **テスト失敗対応**: テスト失敗の原因分析と修正
- **デプロイ問題解決**: デプロイ時の問題対応

#### 実践例

```
# 例1: npm installエラーの解決
#Terminal

依存関係のインストールエラーを解決してください。
互換性のある バージョンを提案してください。

# 例2: テスト失敗の修正
#Terminal

失敗しているテストを修正してください。
テストの意図を維持しながら、実装を修正したいです。

# 例3: ビルドエラーの解決
#Terminal

ビルドエラーを解決してください。
Webpack設定の問題かもしれません。
```

### 5. #Git Diff - Git差分参照

現在の変更内容（コミット前の差分）をKiroに伝えます。

#### 基本的な使い方

```
#Git Diff

この変更をレビューしてください。
```

#### 活用シーン

- **コードレビュー**: 変更内容のレビュー依頼
- **コミットメッセージ生成**: 変更内容に基づくメッセージ作成
- **影響範囲分析**: 変更の影響範囲の確認
- **リファクタリング検証**: 変更が意図通りか確認

#### 実践例

```
# 例1: 変更のレビュー
#Git Diff

この変更をレビューしてください。
以下の観点で確認したいです：
- セキュリティ
- パフォーマンス
- 可読性
- テストカバレッジ

# 例2: コミットメッセージの生成
#Git Diff

この変更に適したコミットメッセージを生成してください。
Conventional Commits形式で作成してください。

# 例3: 破壊的変更の確認
#Git Diff

この変更が既存の機能に影響を与えないか確認してください。
特にAPIの互換性を維持したいです。
```

### 6. #Codebase - コードベース全体参照

プロジェクト全体をインデックス化して、関連するコードを検索・参照します。

#### 基本的な使い方

```
#Codebase

認証機能の実装を探して説明してください。
```

#### 活用シーン

- **機能の探索**: 特定機能の実装場所を特定
- **依存関係分析**: コンポーネント間の依存関係を理解
- **リファクタリング計画**: 影響範囲の全体把握
- **新規参加者のオンボーディング**: プロジェクト構造の理解

#### 実践例

```
# 例1: 機能の実装場所を特定
#Codebase

ユーザー認証機能はどこに実装されていますか？
関連するファイルを全て教えてください。

# 例2: 依存関係の分析
#Codebase

UserServiceに依存しているコンポーネントを
全て教えてください。

# 例3: パターンの統一
#Codebase

APIエンドポイントの実装パターンを分析して、
統一されていない部分を指摘してください。
```

## コンテキストの組み合わせ

複数のコンテキストを組み合わせることで、より正確で効果的な支援を受けられます。

### パターン1: ファイル + 問題

```
#File src/components/UserForm.tsx
#Problems

このファイルの問題を全て修正してください。
```

### パターン2: フォルダ + コードベース

```
#Folder src/components/
#Codebase

このフォルダのコンポーネントが
プロジェクト全体でどのように使用されているか
分析してください。
```

### パターン3: Git Diff + ターミナル

```
#Git Diff
#Terminal

変更後にテストが失敗しています。
原因を特定して修正してください。
```

### パターン4: ファイル + コードベース

```
#File src/services/paymentService.ts
#Codebase

この決済サービスを使用している
全ての箇所を教えてください。
```

## ベストプラクティス

### 1. 段階的なコンテキスト拡張

```
# ステップ1: 特定のファイルから開始
#File src/components/Button.tsx
このコンポーネントを分析してください。

# ステップ2: 関連ファイルを追加
#File src/components/Button.tsx
#File src/styles/button.css
スタイルとの整合性を確認してください。

# ステップ3: 必要に応じてフォルダ全体
#Folder src/components/
全体の一貫性を確認してください。

# ステップ4: 最後の手段としてコードベース全体
#Codebase
プロジェクト全体での使用状況を確認してください。
```

### 2. 具体的な指示と組み合わせる

```
# 良い例
#File src/utils/validator.ts

このバリデーション関数を以下の要件で改善してください：
1. エラーメッセージを日本語化
2. カスタムバリデーションルールの追加
3. 型安全性の向上

# 悪い例
#File src/utils/validator.ts
改善してください。
```

### 3. 適切なスコープの選択

```
# 小さな変更: 特定のファイル
#File src/config.ts
設定値を更新してください。

# 中規模の変更: フォルダ
#Folder src/components/user/
ユーザー関連コンポーネントを統一してください。

# 大規模な変更: コードベース
#Codebase
プロジェクト全体のエラーハンドリングを統一してください。
```

## パフォーマンス最適化

### コンテキストサイズの管理

```typescript
// 効率的なコンテキスト使用
interface ContextStrategy {
  small: string[];    // < 1000行
  medium: string[];   // 1000-5000行
  large: string[];    // > 5000行
}

const strategy: ContextStrategy = {
  // 小規模: 直接ファイル参照
  small: ['#File src/utils/helper.ts'],
  
  // 中規模: フォルダ参照
  medium: ['#Folder src/components/'],
  
  // 大規模: コードベース検索
  large: ['#Codebase', '認証機能の実装を探して']
};
```

### キャッシュの活用

```
# 頻繁に参照するファイルは変数化
設定ファイル = #File src/config.ts
型定義 = #File src/types/index.ts

# 後で参照
{設定ファイル}
{型定義}

この2つのファイルの整合性を確認してください。
```

## トラブルシューティング

### 問題1: コンテキストが大きすぎる

**症状**: 応答が遅い、またはエラーが発生

**解決方法**:
```
# 悪い例
#Codebase
全てのファイルを分析してください。

# 良い例
#Folder src/components/
このフォルダのコンポーネントを分析してください。
```

### 問題2: 関連ファイルが見つからない

**症状**: 必要な情報が不足している

**解決方法**:
```
# 段階的に範囲を拡大
#File src/services/userService.ts
# → 情報不足の場合
#Folder src/services/
# → さらに必要な場合
#Codebase
userServiceに関連するファイルを全て教えてください。
```

### 問題3: #Problemsが検出されない

**症状**: 明らかなエラーがあるのに検出されない

**解決方法**:
```bash
# エディタの診断機能を確認
# TypeScriptサーバーの再起動
# ESLintの設定確認

# または、明示的にファイルを指定
#File src/problematic-file.ts
#Problems
このファイルの問題を確認してください。
```

## 高度な活用テクニック

### 1. 動的コンテキスト生成

```typescript
// スクリプトでコンテキストを生成
const recentFiles = execSync('git diff --name-only HEAD~5')
  .toString()
  .split('\n')
  .filter(f => f.endsWith('.ts'))
  .map(f => `#File ${f}`)
  .join('\n');

console.log(recentFiles);
// Kiroに貼り付けて使用
```

### 2. コンテキストテンプレート

```markdown
<!-- .kiro/templates/review-template.md -->
# コードレビューテンプレート

#Git Diff

以下の観点でレビューしてください：

## セキュリティ
- [ ] 入力値の検証
- [ ] 認証・認可の確認
- [ ] 機密情報の保護

## パフォーマンス
- [ ] 不要な処理の削除
- [ ] 効率的なアルゴリズム
- [ ] メモリ使用量

## 可読性
- [ ] 命名規則の遵守
- [ ] コメントの適切性
- [ ] コードの簡潔性
```

### 3. ワークフロー自動化

```bash
#!/bin/bash
# review-changes.sh

# 変更されたファイルを取得
changed_files=$(git diff --name-only | grep '\.ts$')

# Kiroコンテキストを生成
echo "#Git Diff" > /tmp/kiro-context.txt
echo "" >> /tmp/kiro-context.txt

for file in $changed_files; do
  echo "#File $file" >> /tmp/kiro-context.txt
done

echo "" >> /tmp/kiro-context.txt
echo "これらの変更をレビューしてください。" >> /tmp/kiro-context.txt

# クリップボードにコピー
cat /tmp/kiro-context.txt | pbcopy

echo "Kiroコンテキストをクリップボードにコピーしました。"
```

## まとめ

Chat Context機能の効果的な活用により：

1. **正確な支援**: 必要な情報を的確に伝達
2. **効率的な開発**: 適切なスコープでの作業
3. **品質向上**: 包括的なコードレビューと分析
4. **学習促進**: プロジェクト構造の理解

> 💡 **推奨アプローチ**: 小さなスコープから始めて、必要に応じて段階的に拡大していくことをお勧めします。

> 📖 **公式ドキュメント**: 最新の機能と詳細については [kiro.dev/docs](https://kiro.dev/docs/) を参照してください

---

## 📚 関連リソース

- [🏠 目次](../../README.md)
- [📖 Kiro基礎解説](../chapter1/kiro-introduction.md)
- [🎯 Autonomy Modes](autonomy-modes.md)
- [🛠️ トラブルシューティング](../troubleshooting/common-issues.md)
