# ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†ã‚¬ã‚¤ãƒ‰

## æ¦‚è¦

å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§Kiroã‚’åŠ¹ç‡çš„ã«æ´»ç”¨ã™ã‚‹ãŸã‚ã«ã¯ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®é©åˆ‡ãªåˆ¶å¾¡ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†ãŒé‡è¦ã§ã™ã€‚ã“ã®ã‚¬ã‚¤ãƒ‰ã§ã¯ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ¶å¾¡æ–¹æ³•ã€ãƒ¡ãƒ¢ãƒªåœ§ç¸®æŠ€è¡“ã€ãã—ã¦å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®åŠ¹ç‡çš„ãªé–‹ç™ºæ‰‹æ³•ã«ã¤ã„ã¦è©³ã—ãèª¬æ˜ã—ã¾ã™ã€‚

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡ã®åŸºæœ¬æ¦‚å¿µ

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¨ã¯

Kiroã«ãŠã‘ã‚‹ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã¯ã€AIãŒå‚ç…§ã§ãã‚‹æƒ…å ±ã®ç¯„å›²ã‚’æŒ‡ã—ã¾ã™ã€‚é©åˆ‡ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®åˆ©ç‚¹ãŒå¾—ã‚‰ã‚Œã¾ã™ï¼š

- **å¿œç­”ç²¾åº¦ã®å‘ä¸Š**: é–¢é€£æ€§ã®é«˜ã„æƒ…å ±ã®ã¿ã‚’æä¾›
- **å‡¦ç†é€Ÿåº¦ã®æ”¹å–„**: ä¸è¦ãªæƒ…å ±ã®é™¤å¤–ã«ã‚ˆã‚‹é«˜é€ŸåŒ–
- **ã‚³ã‚¹ãƒˆå‰Šæ¸›**: ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®æœ€é©åŒ–
- **ãƒ¡ãƒ¢ãƒªåŠ¹ç‡**: ã‚·ã‚¹ãƒ†ãƒ ãƒªã‚½ãƒ¼ã‚¹ã®åŠ¹ç‡çš„ãªåˆ©ç”¨

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®ç¨®é¡

Kiroã¯å¼·åŠ›ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆå‚ç…§æ©Ÿèƒ½ã‚’æä¾›ã—ã¦ã„ã¾ã™ï¼š

1. **`#File`**: ç‰¹å®šã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å‚ç…§
   - ä½¿ç”¨ä¾‹: ã€Œ#File app.js ã‚’æœ€é©åŒ–ã—ã¦ã€
   
2. **`#Folder`**: ãƒ•ã‚©ãƒ«ãƒ€å…¨ä½“ã‚’å‚ç…§
   - ä½¿ç”¨ä¾‹: ã€Œ#Folder src/ ã®æ§‹é€ ã‚’èª¬æ˜ã—ã¦ã€
   
3. **`#Codebase`**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã‚’ã‚¤ãƒ³ãƒ‡ãƒƒã‚¯ã‚¹åŒ–ã—ã¦æ¤œç´¢
   - ä½¿ç”¨ä¾‹: ã€Œ#Codebase ã§èªè¨¼æ©Ÿèƒ½ã‚’æ¢ã—ã¦ã€
   
4. **`#Problems`**: ç¾åœ¨ã®ã‚¨ãƒ‡ã‚£ã‚¿ã§æ¤œå‡ºã•ã‚Œã¦ã„ã‚‹å•é¡Œã‚’å‚ç…§
   - ä½¿ç”¨ä¾‹: ã€Œ#Problems ã‚’ä¿®æ­£ã—ã¦ã€
   
5. **`#Terminal`**: ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã®å‡ºåŠ›ã‚’å‚ç…§
   - ä½¿ç”¨ä¾‹: ã€Œ#Terminal ã®ã‚¨ãƒ©ãƒ¼ã‚’è§£æ±ºã—ã¦ã€
   
6. **`#Git Diff`**: ç¾åœ¨ã®å¤‰æ›´å·®åˆ†ã‚’å‚ç…§
   - ä½¿ç”¨ä¾‹: ã€Œ#Git Diff ã‚’ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦ã€

> ğŸ’¡ **æ´»ç”¨ã®ã‚³ãƒ„**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚’çµ„ã¿åˆã‚ã›ã‚‹ã“ã¨ã§ã€ã‚ˆã‚Šæ­£ç¢ºãªæŒ‡ç¤ºãŒå¯èƒ½ã§ã™ã€‚ä¾‹ï¼šã€Œ#File config.js ã¨ #Problems ã‚’è¦‹ã¦ä¿®æ­£ã—ã¦ã€

> ğŸ“– **è©³ç´°**: Chat Contextã®å®Œå…¨ã‚¬ã‚¤ãƒ‰ã¯[æ©Ÿèƒ½ãƒªãƒ•ã‚¡ãƒ¬ãƒ³ã‚¹](../features/chat-context.md)ã‚’å‚ç…§ã—ã¦ãã ã•ã„

## 1. åŠ¹ç‡çš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡æˆ¦ç•¥

### 1.1 æ®µéšçš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ‹¡å¼µ

```markdown
# æ®µéš1: ç‰¹å®šãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰é–‹å§‹
#File src/components/UserProfile.tsx

# æ®µéš2: é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«ã‚’è¿½åŠ 
#File src/types/User.ts
#File src/hooks/useUser.ts

# æ®µéš3: å¿…è¦ã«å¿œã˜ã¦ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’å‚ç…§
#Folder src/components/user/

# æ®µéš4: æœ€å¾Œã®æ‰‹æ®µã¨ã—ã¦ã‚³ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹å…¨ä½“
#Codebase
```

### 1.2 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°

```bash
# ç‰¹å®šã®æ‹¡å¼µå­ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹
find src/ -name "*.ts" -o -name "*.tsx" | head -10

# æœ€è¿‘å¤‰æ›´ã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ã‚’å¯¾è±¡ã¨ã™ã‚‹
git log --name-only --since="1 week ago" --pretty=format: | sort | uniq

# ã‚µã‚¤ã‚ºã®å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ã‚’å„ªå…ˆã™ã‚‹
find src/ -name "*.ts" -exec wc -l {} + | sort -n | head -20
```

### 1.3 å‹•çš„ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†

```typescript
// context-manager.ts
interface ContextConfig {
  maxFiles: number;
  maxTokens: number;
  priorityPatterns: string[];
  excludePatterns: string[];
}

class ContextManager {
  private config: ContextConfig;
  
  constructor(config: ContextConfig) {
    this.config = config;
  }
  
  selectOptimalFiles(basePath: string): string[] {
    const allFiles = this.getAllFiles(basePath);
    const filteredFiles = this.applyFilters(allFiles);
    const prioritizedFiles = this.prioritizeFiles(filteredFiles);
    
    return prioritizedFiles.slice(0, this.config.maxFiles);
  }
  
  private applyFilters(files: string[]): string[] {
    return files.filter(file => {
      // é™¤å¤–ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ãƒã‚§ãƒƒã‚¯
      if (this.config.excludePatterns.some(pattern => 
        file.match(new RegExp(pattern)))) {
        return false;
      }
      
      // ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã®ãƒã‚§ãƒƒã‚¯
      const stats = require('fs').statSync(file);
      return stats.size < 50000; // 50KBæœªæº€
    });
  }
  
  private prioritizeFiles(files: string[]): string[] {
    return files.sort((a, b) => {
      // å„ªå…ˆãƒ‘ã‚¿ãƒ¼ãƒ³ã«ä¸€è‡´ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä¸Šä½ã«
      const aScore = this.calculatePriority(a);
      const bScore = this.calculatePriority(b);
      return bScore - aScore;
    });
  }
}
```

## 2. ãƒ¡ãƒ¢ãƒªåœ§ç¸®æŠ€è¡“

### 2.1 æƒ…å ±ã®éšå±¤åŒ–

```markdown
# ãƒ¬ãƒ™ãƒ«1: æ¦‚è¦æƒ…å ±
## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ§‹é€ 
- Frontend: React + TypeScript
- Backend: Node.js + Express
- Database: PostgreSQL
- Testing: Jest + Cypress

# ãƒ¬ãƒ™ãƒ«2: è©³ç´°æƒ…å ±ï¼ˆå¿…è¦æ™‚ã®ã¿å±•é–‹ï¼‰
<details>
<summary>è©³ç´°ãªã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£æƒ…å ±</summary>

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰è©³ç´°
- State Management: Redux Toolkit
- Routing: React Router v6
- Styling: Tailwind CSS
- Build Tool: Vite

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰è©³ç´°
- Authentication: JWT + Passport.js
- Validation: Joi
- ORM: Prisma
- API Documentation: Swagger

</details>
```

### 2.2 ã‚³ãƒ¼ãƒ‰è¦ç´„æŠ€è¡“

```typescript
// å…ƒã®ã‚³ãƒ¼ãƒ‰ï¼ˆè©³ç´°ç‰ˆï¼‰
export class UserService {
  private userRepository: UserRepository;
  private emailService: EmailService;
  private logger: Logger;
  
  constructor(
    userRepository: UserRepository,
    emailService: EmailService,
    logger: Logger
  ) {
    this.userRepository = userRepository;
    this.emailService = emailService;
    this.logger = logger;
  }
  
  async createUser(userData: CreateUserDto): Promise<User> {
    try {
      // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³
      await this.validateUserData(userData);
      
      // é‡è¤‡ãƒã‚§ãƒƒã‚¯
      const existingUser = await this.userRepository.findByEmail(userData.email);
      if (existingUser) {
        throw new ConflictException('User already exists');
      }
      
      // ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ãƒãƒƒã‚·ãƒ¥åŒ–
      const hashedPassword = await bcrypt.hash(userData.password, 10);
      
      // ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆ
      const user = await this.userRepository.create({
        ...userData,
        password: hashedPassword,
      });
      
      // ã‚¦ã‚§ãƒ«ã‚«ãƒ ãƒ¡ãƒ¼ãƒ«é€ä¿¡
      await this.emailService.sendWelcomeEmail(user.email, user.name);
      
      // ãƒ­ã‚°å‡ºåŠ›
      this.logger.info(`User created: ${user.id}`);
      
      return user;
    } catch (error) {
      this.logger.error('User creation failed', error);
      throw error;
    }
  }
}

// åœ§ç¸®ç‰ˆï¼ˆæ¦‚è¦ã®ã¿ï¼‰
/**
 * UserService - ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹
 * 
 * ä¸»è¦ãƒ¡ã‚½ãƒƒãƒ‰:
 * - createUser(userData): ãƒ¦ãƒ¼ã‚¶ãƒ¼ä½œæˆï¼ˆãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã€é‡è¤‡ãƒã‚§ãƒƒã‚¯ã€ãƒ¡ãƒ¼ãƒ«é€ä¿¡å«ã‚€ï¼‰
 * - updateUser(id, userData): ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±æ›´æ–°
 * - deleteUser(id): ãƒ¦ãƒ¼ã‚¶ãƒ¼å‰Šé™¤
 * - findUser(criteria): ãƒ¦ãƒ¼ã‚¶ãƒ¼æ¤œç´¢
 * 
 * ä¾å­˜é–¢ä¿‚: UserRepository, EmailService, Logger
 */
```

### 2.3 å‹•çš„æƒ…å ±åœ§ç¸®

```bash
#!/bin/bash
# compress-context.sh

# ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºã«åŸºã¥ãåœ§ç¸®ãƒ¬ãƒ™ãƒ«æ±ºå®š
compress_file() {
  local file=$1
  local size=$(wc -c < "$file")
  
  if [ $size -lt 1000 ]; then
    # å°ã•ã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯ãã®ã¾ã¾
    cat "$file"
  elif [ $size -lt 5000 ]; then
    # ä¸­ã‚µã‚¤ã‚ºãƒ•ã‚¡ã‚¤ãƒ«ã¯é–¢æ•°ã‚·ã‚°ãƒãƒãƒ£ã®ã¿
    grep -E "(function|class|interface|type)" "$file"
  else
    # å¤§ãã„ãƒ•ã‚¡ã‚¤ãƒ«ã¯æ§‹é€ ã®ã¿
    echo "# $(basename "$file") - æ§‹é€ æ¦‚è¦"
    grep -E "(export|import|class|interface)" "$file" | head -20
  fi
}

# ä½¿ç”¨ä¾‹
for file in src/**/*.ts; do
  echo "## $file"
  compress_file "$file"
  echo ""
done
```

## 3. å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®åŠ¹ç‡çš„ãªé–‹ç™ºæ‰‹æ³•

### 3.1 ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ†å‰²æˆ¦ç•¥

```typescript
// project-structure.ts
interface ModuleStructure {
  name: string;
  path: string;
  dependencies: string[];
  size: number;
  complexity: 'low' | 'medium' | 'high';
}

const projectModules: ModuleStructure[] = [
  {
    name: 'auth',
    path: 'src/modules/auth',
    dependencies: ['common', 'database'],
    size: 15,
    complexity: 'medium'
  },
  {
    name: 'user-management',
    path: 'src/modules/users',
    dependencies: ['auth', 'common'],
    size: 25,
    complexity: 'high'
  },
  {
    name: 'common',
    path: 'src/common',
    dependencies: [],
    size: 10,
    complexity: 'low'
  }
];

// ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«åˆ¥ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†
class ModuleContextManager {
  getModuleContext(moduleName: string): string[] {
    const module = projectModules.find(m => m.name === moduleName);
    if (!module) return [];
    
    const files = [
      `${module.path}/**/*.ts`,
      ...module.dependencies.map(dep => {
        const depModule = projectModules.find(m => m.name === dep);
        return depModule ? `${depModule.path}/index.ts` : '';
      }).filter(Boolean)
    ];
    
    return files;
  }
}
```

### 3.2 ã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ã‚¿ãƒ«é–‹ç™ºã‚¢ãƒ—ãƒ­ãƒ¼ãƒ

```markdown
# æ®µéšçš„é–‹ç™ºãƒ—ãƒ­ã‚»ã‚¹

## ãƒ•ã‚§ãƒ¼ã‚º1: ã‚³ã‚¢æ©Ÿèƒ½ã®å®Ÿè£…
- åŸºæœ¬çš„ãªCRUDæ“ä½œ
- èªè¨¼ãƒ»èªå¯ã‚·ã‚¹ãƒ†ãƒ 
- ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚¹ã‚­ãƒ¼ãƒ

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¯„å›²
```bash
#Folder src/core/
#File src/types/core.ts
#File src/config/database.ts
```

## ãƒ•ã‚§ãƒ¼ã‚º2: ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã®è¿½åŠ 
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ç®¡ç†æ©Ÿèƒ½
- æ¨©é™ç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 
- é€šçŸ¥æ©Ÿèƒ½

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¯„å›²
```bash
#Folder src/modules/users/
#Folder src/modules/notifications/
#File src/services/auth.service.ts
```

## ãƒ•ã‚§ãƒ¼ã‚º3: UI/UX ã®å®Ÿè£…
- ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆ
- APIçµ±åˆ
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°

### ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç¯„å›²
```bash
#Folder src/components/
#Folder src/pages/
#File src/hooks/useApi.ts
```
```

### 3.3 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ç›£è¦–ã¨æœ€é©åŒ–

```typescript
// performance-monitor.ts
class PerformanceMonitor {
  private metrics: Map<string, number[]> = new Map();
  
  startTimer(operation: string): () => void {
    const start = performance.now();
    
    return () => {
      const duration = performance.now() - start;
      this.recordMetric(operation, duration);
    };
  }
  
  recordMetric(operation: string, value: number): void {
    if (!this.metrics.has(operation)) {
      this.metrics.set(operation, []);
    }
    
    const values = this.metrics.get(operation)!;
    values.push(value);
    
    // æœ€æ–°100ä»¶ã®ã¿ä¿æŒ
    if (values.length > 100) {
      values.shift();
    }
  }
  
  getAverageTime(operation: string): number {
    const values = this.metrics.get(operation) || [];
    return values.reduce((sum, val) => sum + val, 0) / values.length;
  }
  
  generateReport(): string {
    let report = '# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¬ãƒãƒ¼ãƒˆ\n\n';
    
    for (const [operation, values] of this.metrics) {
      const avg = this.getAverageTime(operation);
      const max = Math.max(...values);
      const min = Math.min(...values);
      
      report += `## ${operation}\n`;
      report += `- å¹³å‡: ${avg.toFixed(2)}ms\n`;
      report += `- æœ€å¤§: ${max.toFixed(2)}ms\n`;
      report += `- æœ€å°: ${min.toFixed(2)}ms\n\n`;
    }
    
    return report;
  }
}

// ä½¿ç”¨ä¾‹
const monitor = new PerformanceMonitor();

// Kiroã¨ã®å¯¾è©±æ™‚é–“ã‚’æ¸¬å®š
const endTimer = monitor.startTimer('kiro-response');
// ... Kiroã¨ã®å¯¾è©± ...
endTimer();

// å®šæœŸçš„ãªãƒ¬ãƒãƒ¼ãƒˆç”Ÿæˆ
setInterval(() => {
  console.log(monitor.generateReport());
}, 60000); // 1åˆ†ã”ã¨
```

## 4. å®Ÿè·µçš„ãªæœ€é©åŒ–ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯

### 4.1 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ†å‰²ãƒ‘ã‚¿ãƒ¼ãƒ³

```typescript
// context-splitter.ts
interface ContextChunk {
  id: string;
  content: string;
  priority: number;
  tokens: number;
}

class ContextSplitter {
  private maxTokensPerChunk = 4000;
  
  splitLargeContext(content: string): ContextChunk[] {
    const sections = this.identifySections(content);
    const chunks: ContextChunk[] = [];
    
    let currentChunk = '';
    let currentTokens = 0;
    let chunkId = 0;
    
    for (const section of sections) {
      const sectionTokens = this.estimateTokens(section.content);
      
      if (currentTokens + sectionTokens > this.maxTokensPerChunk) {
        // ç¾åœ¨ã®ãƒãƒ£ãƒ³ã‚¯ã‚’ä¿å­˜
        chunks.push({
          id: `chunk-${chunkId++}`,
          content: currentChunk,
          priority: this.calculatePriority(currentChunk),
          tokens: currentTokens
        });
        
        // æ–°ã—ã„ãƒãƒ£ãƒ³ã‚¯ã‚’é–‹å§‹
        currentChunk = section.content;
        currentTokens = sectionTokens;
      } else {
        currentChunk += section.content;
        currentTokens += sectionTokens;
      }
    }
    
    // æœ€å¾Œã®ãƒãƒ£ãƒ³ã‚¯ã‚’è¿½åŠ 
    if (currentChunk) {
      chunks.push({
        id: `chunk-${chunkId}`,
        content: currentChunk,
        priority: this.calculatePriority(currentChunk),
        tokens: currentTokens
      });
    }
    
    return chunks.sort((a, b) => b.priority - a.priority);
  }
  
  private identifySections(content: string): Array<{content: string, type: string}> {
    // ã‚³ãƒ¼ãƒ‰ãƒ–ãƒ­ãƒƒã‚¯ã€é–¢æ•°ã€ã‚¯ãƒ©ã‚¹ãªã©ã‚’è­˜åˆ¥
    const sections = [];
    const lines = content.split('\n');
    
    let currentSection = '';
    let sectionType = 'general';
    
    for (const line of lines) {
      if (line.match(/^(class|function|interface|type)/)) {
        if (currentSection) {
          sections.push({content: currentSection, type: sectionType});
        }
        currentSection = line + '\n';
        sectionType = 'definition';
      } else {
        currentSection += line + '\n';
      }
    }
    
    if (currentSection) {
      sections.push({content: currentSection, type: sectionType});
    }
    
    return sections;
  }
  
  private estimateTokens(text: string): number {
    // ç°¡æ˜“çš„ãªãƒˆãƒ¼ã‚¯ãƒ³æ•°æ¨å®šï¼ˆå®Ÿéš›ã¯ã‚ˆã‚Šç²¾å¯†ãªè¨ˆç®—ãŒå¿…è¦ï¼‰
    return Math.ceil(text.length / 4);
  }
  
  private calculatePriority(content: string): number {
    let priority = 0;
    
    // ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ãƒ™ãƒ¼ã‚¹ã®å„ªå…ˆåº¦è¨ˆç®—
    const highPriorityKeywords = ['export', 'public', 'interface', 'type'];
    const mediumPriorityKeywords = ['function', 'class', 'const'];
    
    for (const keyword of highPriorityKeywords) {
      priority += (content.match(new RegExp(keyword, 'g')) || []).length * 3;
    }
    
    for (const keyword of mediumPriorityKeywords) {
      priority += (content.match(new RegExp(keyword, 'g')) || []).length * 2;
    }
    
    return priority;
  }
}
```

### 4.2 ã‚­ãƒ£ãƒƒã‚·ãƒ¥æˆ¦ç•¥

```typescript
// context-cache.ts
interface CacheEntry {
  content: string;
  timestamp: number;
  accessCount: number;
  lastAccess: number;
}

class ContextCache {
  private cache = new Map<string, CacheEntry>();
  private maxSize = 100;
  private ttl = 3600000; // 1æ™‚é–“
  
  get(key: string): string | null {
    const entry = this.cache.get(key);
    
    if (!entry) return null;
    
    // TTLãƒã‚§ãƒƒã‚¯
    if (Date.now() - entry.timestamp > this.ttl) {
      this.cache.delete(key);
      return null;
    }
    
    // ã‚¢ã‚¯ã‚»ã‚¹æƒ…å ±æ›´æ–°
    entry.accessCount++;
    entry.lastAccess = Date.now();
    
    return entry.content;
  }
  
  set(key: string, content: string): void {
    // ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚µã‚¤ã‚ºåˆ¶é™
    if (this.cache.size >= this.maxSize) {
      this.evictLeastUsed();
    }
    
    this.cache.set(key, {
      content,
      timestamp: Date.now(),
      accessCount: 1,
      lastAccess: Date.now()
    });
  }
  
  private evictLeastUsed(): void {
    let leastUsedKey = '';
    let leastUsedScore = Infinity;
    
    for (const [key, entry] of this.cache) {
      // ã‚¢ã‚¯ã‚»ã‚¹é »åº¦ã¨æœ€çµ‚ã‚¢ã‚¯ã‚»ã‚¹æ™‚é–“ã‚’è€ƒæ…®ã—ãŸã‚¹ã‚³ã‚¢
      const score = entry.accessCount / (Date.now() - entry.lastAccess);
      
      if (score < leastUsedScore) {
        leastUsedScore = score;
        leastUsedKey = key;
      }
    }
    
    if (leastUsedKey) {
      this.cache.delete(leastUsedKey);
    }
  }
  
  clear(): void {
    this.cache.clear();
  }
  
  getStats(): object {
    return {
      size: this.cache.size,
      hitRate: this.calculateHitRate(),
      oldestEntry: this.getOldestEntry(),
      mostAccessed: this.getMostAccessedEntry()
    };
  }
  
  private calculateHitRate(): number {
    // å®Ÿè£…ã¯çœç•¥ï¼ˆå®Ÿéš›ã®ãƒ’ãƒƒãƒˆç‡è¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
    return 0.85;
  }
  
  private getOldestEntry(): string | null {
    let oldestKey = '';
    let oldestTime = Date.now();
    
    for (const [key, entry] of this.cache) {
      if (entry.timestamp < oldestTime) {
        oldestTime = entry.timestamp;
        oldestKey = key;
      }
    }
    
    return oldestKey || null;
  }
  
  private getMostAccessedEntry(): string | null {
    let mostAccessedKey = '';
    let maxAccess = 0;
    
    for (const [key, entry] of this.cache) {
      if (entry.accessCount > maxAccess) {
        maxAccess = entry.accessCount;
        mostAccessedKey = key;
      }
    }
    
    return mostAccessedKey || null;
  }
}
```

## 5. ç›£è¦–ã¨ãƒ‡ãƒãƒƒã‚°

### 5.1 ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆä½¿ç”¨é‡ã®ç›£è¦–

```bash
#!/bin/bash
# monitor-context-usage.sh

LOG_FILE="context-usage.log"

monitor_context() {
  while true; do
    timestamp=$(date '+%Y-%m-%d %H:%M:%S')
    
    # ãƒ¡ãƒ¢ãƒªä½¿ç”¨é‡
    memory_usage=$(ps aux | grep kiro | awk '{sum+=$6} END {print sum/1024 " MB"}')
    
    # ãƒ•ã‚¡ã‚¤ãƒ«æ•°
    file_count=$(find . -name "*.ts" -o -name "*.tsx" -o -name "*.js" -o -name "*.jsx" | wc -l)
    
    # ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºæ¨å®š
    context_size=$(find . -name "*.ts" -o -name "*.tsx" | xargs wc -c | tail -1 | awk '{print $1/1024 " KB"}')
    
    echo "$timestamp,Memory: $memory_usage,Files: $file_count,Context: $context_size" >> $LOG_FILE
    
    sleep 60  # 1åˆ†é–“éš”
  done
}

# ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å®Ÿè¡Œ
monitor_context &
echo "Context monitoring started. PID: $!"
```

### 5.2 ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æãƒ„ãƒ¼ãƒ«

```typescript
// performance-analyzer.ts
class PerformanceAnalyzer {
  private operations: Array<{
    name: string;
    startTime: number;
    endTime?: number;
    contextSize: number;
    result: 'success' | 'error';
  }> = [];
  
  startOperation(name: string, contextSize: number): string {
    const operationId = `${name}-${Date.now()}`;
    
    this.operations.push({
      name,
      startTime: performance.now(),
      contextSize,
      result: 'success'
    });
    
    return operationId;
  }
  
  endOperation(operationId: string, result: 'success' | 'error' = 'success'): void {
    const operation = this.operations.find(op => 
      `${op.name}-${op.startTime}` === operationId
    );
    
    if (operation) {
      operation.endTime = performance.now();
      operation.result = result;
    }
  }
  
  generateAnalysis(): string {
    const completedOps = this.operations.filter(op => op.endTime);
    
    if (completedOps.length === 0) {
      return 'No completed operations to analyze.';
    }
    
    const analysis = {
      totalOperations: completedOps.length,
      successRate: completedOps.filter(op => op.result === 'success').length / completedOps.length,
      averageTime: completedOps.reduce((sum, op) => sum + (op.endTime! - op.startTime), 0) / completedOps.length,
      contextSizeImpact: this.analyzeContextSizeImpact(completedOps)
    };
    
    return `
# ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹åˆ†æãƒ¬ãƒãƒ¼ãƒˆ

## åŸºæœ¬çµ±è¨ˆ
- ç·æ“ä½œæ•°: ${analysis.totalOperations}
- æˆåŠŸç‡: ${(analysis.successRate * 100).toFixed(2)}%
- å¹³å‡å®Ÿè¡Œæ™‚é–“: ${analysis.averageTime.toFixed(2)}ms

## ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºã®å½±éŸ¿
${analysis.contextSizeImpact}

## æ¨å¥¨äº‹é …
${this.generateRecommendations(analysis)}
    `;
  }
  
  private analyzeContextSizeImpact(operations: any[]): string {
    const sizeGroups = {
      small: operations.filter(op => op.contextSize < 1000),
      medium: operations.filter(op => op.contextSize >= 1000 && op.contextSize < 5000),
      large: operations.filter(op => op.contextSize >= 5000)
    };
    
    let impact = '';
    for (const [size, ops] of Object.entries(sizeGroups)) {
      if (ops.length > 0) {
        const avgTime = ops.reduce((sum, op) => sum + (op.endTime! - op.startTime), 0) / ops.length;
        impact += `- ${size}: ${ops.length}æ“ä½œ, å¹³å‡${avgTime.toFixed(2)}ms\n`;
      }
    }
    
    return impact;
  }
  
  private generateRecommendations(analysis: any): string {
    const recommendations = [];
    
    if (analysis.successRate < 0.9) {
      recommendations.push('- ã‚¨ãƒ©ãƒ¼ç‡ãŒé«˜ã„ãŸã‚ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã‚µã‚¤ã‚ºã®å‰Šæ¸›ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
    }
    
    if (analysis.averageTime > 5000) {
      recommendations.push('- å®Ÿè¡Œæ™‚é–“ãŒé•·ã„ãŸã‚ã€ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆã®åˆ†å‰²ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
    }
    
    if (analysis.contextSizeImpact.includes('large')) {
      recommendations.push('- å¤§ããªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸã€‚æ®µéšçš„ãªæƒ…å ±æä¾›ã‚’æ¤œè¨ã—ã¦ãã ã•ã„');
    }
    
    return recommendations.length > 0 ? recommendations.join('\n') : '- ç¾åœ¨ã®ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¯è‰¯å¥½ã§ã™';
  }
}

// ä½¿ç”¨ä¾‹
const analyzer = new PerformanceAnalyzer();

// æ“ä½œã®é–‹å§‹
const opId = analyzer.startOperation('code-generation', 2500);

// ... å®Ÿéš›ã®å‡¦ç† ...

// æ“ä½œã®çµ‚äº†
analyzer.endOperation(opId, 'success');

// åˆ†æãƒ¬ãƒãƒ¼ãƒˆã®ç”Ÿæˆ
console.log(analyzer.generateAnalysis());
```

## ã¾ã¨ã‚

åŠ¹æœçš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†ã«ã‚ˆã‚Šã€å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚Kiroã‚’åŠ¹ç‡çš„ã«æ´»ç”¨ã§ãã¾ã™ã€‚é‡è¦ãªãƒã‚¤ãƒ³ãƒˆã¯ï¼š

- **æ®µéšçš„ãªã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ‹¡å¼µ**: å¿…è¦æœ€å°é™ã‹ã‚‰å§‹ã‚ã¦å¾ã€…ã«æ‹¡å¼µï¼ˆ#File â†’ #Folder â†’ #Codebaseï¼‰
- **æƒ…å ±ã®éšå±¤åŒ–**: æ¦‚è¦ã‹ã‚‰è©³ç´°ã¸ã®ãƒ‰ãƒªãƒ«ãƒ€ã‚¦ãƒ³æ–¹å¼
- **Chat Contextã®æ´»ç”¨**: 6ã¤ã®ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆæ©Ÿèƒ½ã‚’é©åˆ‡ã«çµ„ã¿åˆã‚ã›ã‚‹
- **å‹•çš„ãªæœ€é©åŒ–**: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã®æˆé•·ã«åˆã‚ã›ãŸè¨­å®šèª¿æ•´
- **ç¶™ç¶šçš„ãªç›£è¦–**: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã®å®šæœŸçš„ãªç¢ºèª

ã“ã‚Œã‚‰ã®æŠ€è¡“ã‚’æ´»ç”¨ã™ã‚‹ã“ã¨ã§ã€å¤§è¦æ¨¡ãªãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã‚‚å¿«é©ã«Kiroã‚’ä½¿ç”¨ã—ã€é«˜å“è³ªãªã‚½ãƒ•ãƒˆã‚¦ã‚§ã‚¢é–‹ç™ºã‚’å®Ÿç¾ã§ãã¾ã™ã€‚

> ğŸ“– **å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆç®¡ç†ã®æœ€æ–°æƒ…å ±ã«ã¤ã„ã¦ã¯ [kiro.dev/docs](https://kiro.dev/docs/) ã‚’å‚ç…§ã—ã¦ãã ã•ã„

ãƒãƒ¼ãƒ é–‹ç™ºã®å®Œå…¨ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã«ã¤ã„ã¦ã¯ã€[ãƒãƒ¼ãƒ é–‹ç™ºã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—ã‚¬ã‚¤ãƒ‰](team-development-setup.md)ã¨[Steeringãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†æˆ¦ç•¥ã‚¬ã‚¤ãƒ‰](steering-management.md)ã‚‚ä½µã›ã¦å‚ç…§ã—ã¦ãã ã•ã„ã€‚---


## ğŸ“š å­¦ç¿’é€²æ—ãƒã‚§ãƒƒã‚¯

ã“ã®ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å®Œäº†ã—ãŸã‚‰ã€ä»¥ä¸‹ã®é …ç›®ãŒã§ãã‚‹ã‚ˆã†ã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ãã ã•ã„ï¼š

- [ ] ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåˆ¶å¾¡ã®æ–¹æ³•ã¨ãƒ¡ãƒ¢ãƒªç®¡ç†ã‚’ç†è§£ã—ã¦ã„ã‚‹
- [ ] å¤§è¦æ¨¡ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã§ã®åŠ¹ç‡çš„ãªé–‹ç™ºæ‰‹æ³•ã‚’èº«ã«ã¤ã‘ã¦ã„ã‚‹
- [ ] ãƒ¡ãƒ¢ãƒªåœ§ç¸®æŠ€è¡“ã‚’æ´»ç”¨ã§ãã‚‹
- [ ] å¤§è¦æ¨¡é–‹ç™ºã§ã®Kiroæ´»ç”¨ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯ã‚’ç¿’å¾—ã—ã¦ã„ã‚‹
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãŒã§ãã‚‹

---

<div align="center">

| [â† ğŸ“ Steeringç®¡ç†æˆ¦ç•¥](steering-management.md) | [ğŸ  ç›®æ¬¡](../../README.md) | [ğŸ› ï¸ ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° â†’](../troubleshooting/common-issues.md) |
|:---:|:---:|:---:|

</div>

---

### ğŸ”— é–¢é€£ãƒªã‚½ãƒ¼ã‚¹
- [ğŸ§  ãƒ¡ãƒ¢ãƒªç®¡ç†ãƒ†ã‚¯ãƒ‹ãƒƒã‚¯](../troubleshooting/common-issues.md)
- [â“ FAQ](../troubleshooting/faq.md)
- [ğŸ“– ç›®æ¬¡](../../README.md)